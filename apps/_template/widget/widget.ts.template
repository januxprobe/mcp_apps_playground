import { App } from "@modelcontextprotocol/ext-apps";

// Initialize the MCP App
const app = new App({
  name: "{{APP_NAME}} Widget",
  version: "1.0.0",
});

// OPTIONAL: Multilingual support
// Uncomment and customize for multilingual apps:
//
// type Language = 'en' | 'nl' | 'fr';
//
// const TRANSLATIONS = {
//   en: {
//     title: "My App",
//     subtitle: "App description",
//     buttonText: "Click me",
//     // Add more translations...
//   },
//   nl: {
//     title: "Mijn App",
//     subtitle: "App beschrijving",
//     buttonText: "Klik mij",
//   },
//   fr: {
//     title: "Mon Application",
//     subtitle: "Description de l'application",
//     buttonText: "Cliquez-moi",
//   },
// };
//
// function getT(language: Language = 'en') {
//   return TRANSLATIONS[language] || TRANSLATIONS.en;
// }
//
// // Update header with translations
// function updateHeader(language: Language = 'en') {
//   const t = getT(language);
//   const titleEl = document.querySelector("h1");
//   const subtitleEl = document.querySelector(".subtitle");
//   if (titleEl) titleEl.textContent = t.title;
//   if (subtitleEl) subtitleEl.textContent = t.subtitle;
// }
//
// See apps/hospi-copilot for a complete multilingual implementation example.

// DOM elements
const contentEl = document.getElementById("content") as HTMLElement;
const statusEl = document.getElementById("status") as HTMLElement;
const timestampEl = document.getElementById("timestamp") as HTMLElement;
const errorContainerEl = document.getElementById("error-container") as HTMLElement;
const actionBtn = document.getElementById("action-btn") as HTMLButtonElement;

/**
 * Formats ISO timestamp to readable format
 */
function formatTimestamp(isoString: string): string {
  const date = new Date(isoString);
  return date.toLocaleTimeString();
}

/**
 * Shows an error message
 */
function showError(message: string): void {
  errorContainerEl.innerHTML = `<div class="error">‚ùå ${message}</div>`;
  setTimeout(() => {
    errorContainerEl.innerHTML = "";
  }, 5000);
}

/**
 * Updates the UI with tool results
 */
function updateUI(result: any): void {
  try {
    const data = result.structuredContent;

    if (!data) {
      showError("No data received from tool");
      return;
    }

    // TODO: Update your UI elements based on the tool result
    // Example:
    if (data.input) {
      contentEl.textContent = JSON.stringify(data.input, null, 2);
    }

    if (data.timestamp) {
      timestampEl.textContent = formatTimestamp(data.timestamp);
    }

    statusEl.textContent = "Updated";

    console.error("‚úÖ Widget UI updated:", data);
  } catch (error) {
    console.error("‚ùå Error updating UI:", error);
    showError("Failed to update UI");
  }
}

/**
 * Calls the server tool
 */
async function performAction(): Promise<void> {
  try {
    console.error("üîß Calling {{TOOL_NAME}} tool...");

    // TODO: Replace with your actual tool name and arguments
    const result = await app.callServerTool({
      name: "{{TOOL_NAME}}",
      arguments: {
        text: "Example input",
        // Add your tool's parameters here
      },
    });

    console.error("üì• Tool result:", result);
    updateUI(result);
  } catch (error) {
    console.error("‚ùå Error calling tool:", error);
    showError("Failed to execute tool");
  }
}

// Set up event listeners
actionBtn.addEventListener("click", performAction);

// Handle tool results from ChatGPT
app.ontoolresult = (result) => {
  console.error("üì• Tool result received from ChatGPT:", result);
  updateUI(result);
};

// Connect to MCP host
console.error("üîå Connecting {{APP_NAME}} Widget to MCP host...");
app.connect();

console.error("‚úÖ {{APP_NAME}} Widget initialized");
